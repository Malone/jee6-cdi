#summary Design notes on common interface to CDI SE
#labels internal,not-meant-for-non-project-members,tutorial-support,Phase-Design,Phase-Requirements,design-notes

= Introduction =

There is no standard interface to doing CDI SE. 
We would like this for the tutorial series so folks can download the tutorials and get them to work
with their CDI container of choice. This will also be useful for unit testing.

[http://seamframework.org/Weld Weld] has a way. 
[http://caucho.com/resin-4.0/ Caucho Resin] has a way. 
And, we assume [http://openwebbeans.apache.org/ Apache OpenWebBeans] has a way.

We are most familiar with Resin and Weld so we will start with them.

= Design goals =

 * Single interface for looking up beans by annotation and name 
 * Single callback for being notified when the container starts up (nice to have for now)

The goals may change as we progress. For now, we want this to work with both Resin and Weld. In the future, we will get it to work with OpenWebBeans.

For now, we just want a standard way to host our examples for our tutorials series.

The vision is as follows:

 * Create a github account for this project to host this common interface for CDI SE
 * Host a maven repository here at this project site which will host this artifact
 * Change tutorial to use this maven repo as a repository
 * Add items to the common lib as needed
 * To keep the maven pom.xml files simple, we will branch the tutorial into three branches, 
      ** one for Resin
     ** one for Weld
     ** one for OpenWebBeans
 * End user will use the branch based on the CDI SE container they are interested in

For now this new artifact will be called org.github.cdiadvocate:cdise.

== Design Notes for Resin ==

`com.caucho.resin.ResinBeanContainer` is the main interface for Resin's CDI container. You can use this
to run CDI from a main method.

`ResinBeanContainer` has a method called getBeanByName and getInstance(Class, Annotation...) to look up a bean by its class and a list of annotations. There is also a start method to start the container. There are methods to add jars files and classpaths locations of classes to scan. Resin uses compiling class-loaders so the locations can have Java source and Resin will compile it and add the annotations. Resin's approach is very powerful.

== Design Notes for Weld ==
Weld allows the launch of CDI applications through its `org.jboss.weld.environment.se.StartMain`. You just ensure the jar files, and classpath is setup ahead of time. You can not manipulate the classpath like you can with `ResinBeanContainer` so our common interface should probably leave that important feature out (for now). We can add this feature later if needed.

Internally `StartMain` uses `WeldContainer` (`org.jboss.weld.environment.se.WeldContainer`). `WeldContainer` does not do much.  To get a `WeldContainer` you initialize the `Weld` CDI system (`org.jboss.weld.environment.se.Weld`) like so:

{{{
        WeldContainer weld = new Weld().initialize();

}}}


{{{
//import InstanceManager same package internal class to Weld
//
public class WeldContainer
{

   private final InstanceManager instanceManager;
   private final BeanManager beanManager;

   @Inject
   protected WeldContainer(InstanceManager instanceManager, BeanManager beanManager)
   {
      this.instanceManager = instanceManager;
      this.beanManager = beanManager;
   }
...
   public Instance<Object> instance() {
      return instanceManager.getInstances();
   }
...
 
  public BeanManager getBeanManager()
   {
      return beanManager;
   }
}

}}}
